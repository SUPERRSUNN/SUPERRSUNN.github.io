---
layout: post
title: "Kernel Analysis, Memory"
date: 2025-09-27 24:10:00 +0900
tags: ["Kernel", "Memory"]
---

# Physical Memory
  
메모리는 컴퓨터를 구성하는 중요한 자원 중 하나이다. 또한 컴퓨터 구조에 따라 메모리를 다른 방식으로 관리한다. 리눅스 커널은 다양한 메모리 관리 방식에 모두 적합하도록 설계되었다. 먼저 어떤 메모리 아키텍쳐가 있는 지 살펴보자.  

## NUMA(Non-Uniform Memory Access)
  
NUMA는 고성능 서버 컴퓨터와 같은 멀티코어 및 멀티 스레딩 시스템에서 일반적인 메모리 아키텍처이다. NUMA 구조는 CPU가 메모리에 접근하는 속도가 다를 수 있다는 점을 전제로 한다.
이로 인해 동등하게 취급되는 메모리가 물리적인 거리 차이로 인해 성능의 차이가 발생할 수 있다. NUMA 구조는 이를 node의 개념을 도입해 해결한다. node는 CPU가 빠르고 동등하게 접근할 수 있는 메모리를 묶어 놓은 것으로 CPU마다 할당된다. node 내의 메모리는 해당 CPU에서 로컬 메모리라고 불리며 이외의 메모리는 원격 메모리라고 한다. 커널은 이 node를 pg_data_t란 구조체로 추상화 한다. 그리고 node들을 pgdat_list란 배열로 관리한다. node는 또 zone으로 나뉜다. zone은 32bit 시스템에서 주로 사용되었으며 64bit 시스템에서는 하위 호환성 때문에 유지하는 개념이다. zone은 node 내의 물리 메모리들을 ZONE_DMA, ZONE_NORMAL, ZONE_HIGHMEM으로 나눈다. ZONE_DMA는 0-16MB에 해당하는 영역으로 Direct Memory Access를 할 수 있도록 예약된 영역이다. ZONE_NORMAL은 모든 작업에 사용될 수 있는 범용 영역으로 커널은 기본적으로 이 영역에서 작업을 수행하려 한다. ZONE_HIGHMEM 영역은 32bit 시스템에서만 사용되는 영역으로 한정된 가상 주소 공간으로 인해 필요한 영역이었지만, 64bit 시스템은 가상 공간이 매우 방대하기에 쓸모가 없어졌다. 

## UMA(Uniform Memory Access)
  
UMA는 CPU가 어떤 메모리에 접근하든지 접근 속도가 일정할 거란 가정을 한다. 이 메모리 아키텍쳐는 일반적인 PC에서 구현하며, 커널은 NUMA에서 구현하는 pg_data_t, node와 같은 개념은 1개만 두어 구현한다. 

## Page Frame
  
물리 메모리는 Page Frame이란 요소로 나뉜다. 이는 대부분 4KB 크기로 커널은 각각의 Page Frame을 struct page란 구조체로 다룬다. 이 구조체는 해당 Page Frame의 상태를 저장하며, Buddy 할당자와 같은 메커니즘으로 관리된다. 

# Virtual Memory
